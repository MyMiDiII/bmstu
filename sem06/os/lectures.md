# Лекция 2

монтирование --- это система действий, в результате которой файловая система
становится доступной.

Для монтирования ФС требуются права привилегированного пользователя.

Используется команда mount.

`mount ключи -t тип_файловой_системы -o опции_файловой_системы устройство
каталог_назначения`

Отмонтирование:

`umount ключи -t тип_файл_сист -o опции_ф_с`

Кроме основной команды есть две команды: там могут указываться имя ФС.

`mount.nfs`

Есть разные версии.

Винда:

`mount.ntfs`

Наиболее часто:

* имя устройства или другого ресурса, который содержит монтируемую ФС;
* точка монтирования --- каталог, к которому подмонтируется ФС; должна
  существовать, иначе ошибка.

Когда ФС смонтирована в существ. дир., все файлы и поддир. этой
смонтированной системы становятся файлами и поддир точки монтирования.

Если дир. тм содержала к-л. файлы и поддир, то они не теряются, а становятся
невидимыми.

Иногда может оказаться нужным явно указывать при монтировании тип ФС (опция
-t).

Например, если осуществляетя попытка подмонтированить новую ФС, имеющую
новый тип, но поскольку U/L могут поддерживать большое количество
ФС (они могут поддерживать ФС разных типов), ... структуру ФС.

Рассмотрим пример.

```bash
# mount /dev/sda1 /mnt
```

Пытается монтированть устройство /dev/sda1 с файловой системой ext3 в каталог
mnt с режимом только чтение.

Если нет библиотек для поддержки той или иной ФС, или система не является ext3,
будет выведено сообщение о невозможности монтирования.

Если необходимо включить режим только записи:

```bash
# mount -o rw /dev/sda1 /mnt
```

Структура superblock предназначена для описания подмонтированных ФС.

Она содержит всю необходимую инф-цию для обращения к файлам конкретной ФС.

struct inode --- дескриптор физ. файла.

struct dentry --- описывает элемент каталога (доступ к файлам).

struct file --- описывает открытый файл (открыт к-л процессом).

Для системы существуют только процессы, их она обслуживает, ими она
управляет.

Команды, которые мы пишем в ком строке --- коды системы, которые ей
выполняются.

**ЗДЕСЬ ДОЛЖНА БЫТЬ ФОТКА. ТАК ВАНЯ СКАЗАЛ.**

Кеши по своему назначению хранят данные, к которым били последние
обращения, по принципу lru, по принципу наибольшей вероятности обращений.

Для деятельности человека хар-но, что он обращался к данным, то в след
момент, он будет обращаться к этим же данным.

Системная таблица открытых файлов. В этой таблице --- десрипторы всех
открытых в системе файлов, если файл открыт несколько раз, то будет
существовать соотв. кол-во дескрипторов файлов.

Т. к. дескрипторы --- структура для обслуживания
...............................................................................
.................................................

Одно имя --- для системы это хардлинк.

## СуперБлок

Раздел жесткого диска (всторичной памяти) с ФС ext2.

Блок -- минимально адресуемая единица физ. носителя (вторичной памяти).

ФС предназначена для долговременного хранения и доступа к файлам. Без доступа
никому не нужно.

Доступ многоуровневый. Втор. память --- внешнее устройство.

Дисковые inode содержат информацию об адресах блоках втор. памяти, в которой
находится файл, кот. описывается конкретным inode-ом.

inode корневого каталога...

Суперблок хранит инфомацию об inod-ах, обеспечивает доступ к дисковому айноду,
а дисковый айнод хранит информацию об адресах.

**ЗДЕСЬ ДОЛЖНА БЫТЬ СУПЕРСХЕМА СУПЕРБЛОКА**

Суперблоки в системе объединены в списко. В системе столько действующих
суперблоков, соклько смонтированно ФС. Мб смонитрованно несколько ФС одного и
того же типа.

Доступ к файлам возможен только в смонтированной ФС, нужен соотв. суперблок.

```c
struct super_block
{
    struct list_head s_list;
    dev_t s_dev;
    unsigned long s_blocksize;
    struct file_system_type *s_type; \\ структура file_system_type предназначена для
                                     \\ регистрации типа конкретной ФС
    const struct super_operations *s_op;
    unsigned long s_flags;
    unsigned long s_magic;
    struct dentry *s_root;
    struct rw_semaphore s_umount;
    struct list_head s_mount;
    struct block_device *s_bder;
    ...
    struct list_head s_inodes_wb;
}
```
Грязный файл --- измененное значение.
**PHOTO AGAIN**


